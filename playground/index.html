<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>IrsanAI TPM Playground</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #0d1117; color: #e6edf3; }
    h1 { margin-bottom: 6px; }
    .row { display: flex; gap: 16px; flex-wrap: wrap; }
    .card { background:#161b22; border:1px solid #30363d; border-radius:10px; padding:14px; flex:1; min-width:280px; }
    label { display:block; margin-top:8px; font-size: 14px; }
    input { width:100%; }
    button { margin-top:10px; padding:8px 12px; border-radius:8px; border:1px solid #30363d; background:#238636; color:white; cursor:pointer; }
    canvas { width:100%; height:180px; background:#0b1320; border-radius:8px; margin-top:8px; }
    .muted { color:#8b949e; font-size: 13px; }
    code { background: #21262d; padding: 2px 5px; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>ðŸ§  IrsanAI TPM Playground (MVP)</h1>
  <p class="muted">Weak-signal anomaly simulation for single-agent, mini-swarm, and cross-domain transfer resonance.</p>

  <div class="row">
    <div class="card">
      <h3>Controls</h3>
      <label>Seed <input id="seed" type="number" value="42"></label>
      <label>Points <input id="points" type="range" min="80" max="260" value="140"></label>
      <label>Threshold <input id="threshold" type="range" min="5" max="60" value="18"></label>
      <button onclick="runAll()">Regenerate</button>
      <p class="muted">TPM framing: probabilistic early detection (not deterministic prediction).</p>
    </div>

    <div class="card">
      <h3>Single Agent (Finance)</h3>
      <canvas id="single"></canvas>
      <p id="singleStats"></p>
    </div>

    <div class="card">
      <h3>Mini Swarm (BTC / COFFEE / VOL)</h3>
      <canvas id="swarm"></canvas>
      <p id="swarmStats"></p>
    </div>
  </div>

  <div class="row" style="margin-top:16px;">
    <div class="card">
      <h3>Cross-domain Transfer (Finance â†’ Weather â†’ Health)</h3>
      <canvas id="xdomain"></canvas>
      <p id="xStats"></p>
      <p class="muted">Synthetic demo for concept feel. Real transfer requires governance + domain-safe features.</p>
    </div>
  </div>

  <script>
    function rng(seed) {
      let s = seed >>> 0;
      return () => ((s = (1664525 * s + 1013904223) >>> 0) / 4294967296);
    }

    function series(seed, n, noise=0.25) {
      const rnd = rng(seed);
      const out = [];
      for (let i=0;i<n;i++) {
        const base = Math.sin(i/8)*0.6 + Math.cos(i/19)*0.4;
        const micro = Math.sin(i/3.7)*0.08;
        const jitter = (rnd()-0.5) * noise * 0.3;
        out.push(base + micro + jitter);
      }
      return out;
    }

    function glitches(arr, threshold) {
      const g=[];
      for (let i=2;i<arr.length;i++) {
        const accel = arr[i] - (2*arr[i-1]-arr[i-2]);
        if (Math.abs(accel) > threshold) g.push({i, s:accel});
      }
      return g;
    }

    function draw(canvas, lines) {
      const c = document.getElementById(canvas);
      const ctx = c.getContext('2d');
      c.width = c.clientWidth; c.height = c.clientHeight;
      ctx.clearRect(0,0,c.width,c.height);
      const all = lines.flatMap(x=>x.data);
      const min = Math.min(...all), max = Math.max(...all);
      const pad=16;
      const sx = (i,n)=> pad + (i/(n-1))*(c.width-2*pad);
      const sy = v => c.height-pad - ((v-min)/(max-min||1))*(c.height-2*pad);
      lines.forEach(line=>{
        ctx.strokeStyle=line.color; ctx.lineWidth=1.5; ctx.beginPath();
        line.data.forEach((v,i)=>{ const x=sx(i,line.data.length), y=sy(v); if(i===0)ctx.moveTo(x,y); else ctx.lineTo(x,y);});
        ctx.stroke();
      });
    }

    function runAll() {
      const seed = Number(document.getElementById('seed').value||42);
      const points = Number(document.getElementById('points').value||140);
      const threshold = Number(document.getElementById('threshold').value||18)/100;

      const single = series(seed, points);
      const sg = glitches(single, threshold);
      draw('single', [{data:single,color:'#58a6ff'}]);
      document.getElementById('singleStats').innerHTML = `Glitches: <code>${sg.length}</code> â€¢ Threshold: <code>${threshold.toFixed(2)}</code>`;

      const btc = series(seed+1, points, 0.25), coffee = series(seed+7, points, 0.32), vol = series(seed+23, points, 0.21);
      const bg=glitches(btc,threshold), cg=glitches(coffee,threshold), vg=glitches(vol,threshold);
      draw('swarm', [
        {data:btc,color:'#2ea043'},{data:coffee,color:'#f0883e'},{data:vol,color:'#a371f7'}
      ]);
      const pressure = ((bg.length+cg.length+vg.length)/(3*points)*100).toFixed(2);
      document.getElementById('swarmStats').innerHTML = `BTC: <code>${bg.length}</code> â€¢ COFFEE: <code>${cg.length}</code> â€¢ VOL: <code>${vg.length}</code> â€¢ Swarm pressure: <code>${pressure}%</code>`;

      const fin = series(seed+100, points, 0.28), wet = series(seed+200, points, 0.26), heal = series(seed+300, points, 0.24);
      const fg=glitches(fin,threshold), wg=glitches(wet,threshold), hg=glitches(heal,threshold);
      draw('xdomain', [
        {data:fin,color:'#58a6ff'},{data:wet,color:'#d29922'},{data:heal,color:'#ff7b72'}
      ]);
      const fset = new Set(fg.slice(-25).map(x=>x.i));
      let resonance = 0;
      wg.slice(-25).forEach(x=>{ if(fset.has(x.i)) resonance++;});
      hg.slice(-25).forEach(x=>{ if(fset.has(x.i)) resonance++;});
      document.getElementById('xStats').innerHTML = `Finance: <code>${fg.length}</code> â€¢ Weather: <code>${wg.length}</code> â€¢ Health: <code>${hg.length}</code> â€¢ Transfer resonance: <code>${resonance}</code>`;
    }

    runAll();
  </script>
</body>
</html>
