services:
  tpm-preflight:
    build: .
    environment:
      - ALPHAVANTAGE_KEY=${ALPHAVANTAGE_KEY:-}
    command: ["python", "scripts/tpm_cli.py", "preflight", "--market", "ALL"]

  tpm-live:
    build: .
    environment:
      - ALPHAVANTAGE_KEY=${ALPHAVANTAGE_KEY:-}
    command: ["python", "scripts/tpm_cli.py", "live", "--history-csv", "btc_real_24h.csv", "--poll-seconds", "3600"]

  tpm-forge-web:
    build: .
    environment:
      - ALPHAVANTAGE_KEY=${ALPHAVANTAGE_KEY:-}
    command: ["uvicorn", "production.forge_runtime:app", "--host", "0.0.0.0", "--port", "8787"]
    ports:
      - "8787:8787"
